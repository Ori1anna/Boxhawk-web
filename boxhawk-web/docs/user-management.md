# ç”¨æˆ·è§’è‰²ç®¡ç†æŒ‡å—

## ðŸ”§ å¦‚ä½•åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·è§’è‰²

### **æ–¹æ³•ä¸€ï¼šé€šè¿‡ Supabase Dashboardï¼ˆæŽ¨èï¼‰**

#### 1. åˆ›å»ºç¬¬ä¸€ä¸ª Admin ç”¨æˆ·

1. **ç™»å½• Supabase Dashboard**
   - è®¿é—® [supabase.com](https://supabase.com)
   - é€‰æ‹©ä½ çš„é¡¹ç›®

2. **è¿›å…¥ Authentication**
   - å·¦ä¾§èœå•ï¼šAuthentication > Users
   - ç‚¹å‡» "Add user" æŒ‰é’®

3. **åˆ›å»ºç”¨æˆ·**
   - Email: è¾“å…¥ä½ çš„é‚®ç®±
   - Password: è®¾ç½®å¯†ç 
   - ç‚¹å‡» "Create user"

4. **è®¾ç½®è§’è‰²**
   - æ‰¾åˆ°åˆšåˆ›å»ºçš„ç”¨æˆ·
   - ç‚¹å‡»ç”¨æˆ·è¿›å…¥è¯¦æƒ…é¡µ
   - åœ¨ "App metadata" éƒ¨åˆ†æ·»åŠ ï¼š
   ```json
   {
     "role": "admin"
   }
   ```

#### 2. éªŒè¯è§’è‰²è®¾ç½®

1. **æ£€æŸ¥ç”¨æˆ·è§’è‰²**
   - åœ¨ç”¨æˆ·è¯¦æƒ…é¡µç¡®è®¤ App metadata ä¸­æœ‰ `"role": "admin"`
   - æˆ–è€…è¿è¡Œ SQL æŸ¥è¯¢ï¼š
   ```sql
   SELECT email, app_metadata->>'role' as role 
   FROM auth.users 
   WHERE email = 'your-email@example.com';
   ```

2. **æµ‹è¯•ç™»å½•**
   - ä½¿ç”¨è®¾ç½®çš„é‚®ç®±å’Œå¯†ç ç™»å½•åº”ç”¨
   - ç¡®è®¤èƒ½çœ‹åˆ° Admin åŠŸèƒ½

### **æ–¹æ³•äºŒï¼šé€šè¿‡åº”ç”¨å†…ç®¡ç†ï¼ˆéœ€è¦ Admin æƒé™ï¼‰**

#### 1. ä½¿ç”¨ Admin Users é¡µé¢

1. **ç™»å½•ä¸º Admin**
   - ä½¿ç”¨å·²è®¾ç½®çš„ Admin è´¦æˆ·ç™»å½•
   - è®¿é—® `/admin/users` é¡µé¢

2. **æ·»åŠ æ–°ç”¨æˆ·**
   - ç‚¹å‡» "Add User" æŒ‰é’®
   - å¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼š
     - Email: ç”¨æˆ·é‚®ç®±
     - Password: ç”¨æˆ·å¯†ç 
     - Role: é€‰æ‹©è§’è‰²ï¼ˆPhoto User, Expert, Admin, Super Adminï¼‰

3. **ç®¡ç†çŽ°æœ‰ç”¨æˆ·**
   - åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ›´æ”¹ç”¨æˆ·è§’è‰²
   - åˆ é™¤ä¸éœ€è¦çš„ç”¨æˆ·

### **æ–¹æ³•ä¸‰ï¼šé€šè¿‡ SQL ç›´æŽ¥ä¿®æ”¹**

#### 1. åœ¨ Supabase SQL Editor ä¸­è¿è¡Œ

```sql
-- æ›´æ–°çŽ°æœ‰ç”¨æˆ·è§’è‰²
UPDATE auth.users 
SET app_metadata = jsonb_set(
  COALESCE(app_metadata, '{}'::jsonb), 
  '{role}', 
  '"admin"'
)
WHERE email = 'your-email@example.com';

-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·è§’è‰²
SELECT 
  email,
  app_metadata->>'role' as role,
  created_at
FROM auth.users 
ORDER BY created_at DESC;
```

## ðŸ“‹ è§’è‰²æƒé™è¯´æ˜Ž

### **è§’è‰²å±‚æ¬¡ç»“æž„**
1. **PhotoUser** (æœ€ä½Žæƒé™)
   - å¯ä»¥ä¸Šä¼ ç…§ç‰‡å’ŒåŸºæœ¬ä¿¡æ¯
   - è®¿é—®ï¼šé¦–é¡µã€ä¸Šä¼ é¡µé¢ã€æˆåŠŸé¡µé¢

2. **Expert** (ä¸­ç­‰æƒé™)
   - å¯ä»¥å®¡æ ¸å’Œå¤„ç†ä¸Šä¼ çš„é¡¹ç›®
   - è®¿é—®ï¼šé¦–é¡µã€Items åˆ—è¡¨ã€Item è¯¦æƒ…ã€Review é¡µé¢

3. **Admin** (é«˜æƒé™)
   - å¯ä»¥ç®¡ç†ç”¨æˆ·è´¦æˆ·
   - è®¿é—®ï¼šæ‰€æœ‰ Expert åŠŸèƒ½ + ç”¨æˆ·ç®¡ç†

4. **SuperAdmin** (æœ€é«˜æƒé™)
   - å¯ä»¥åˆ›å»ºå…¶ä»– SuperAdmin
   - è®¿é—®ï¼šæ‰€æœ‰åŠŸèƒ½

### **é¡µé¢è®¿é—®æƒé™**

| é¡µé¢ | PhotoUser | Expert | Admin | SuperAdmin |
|------|-----------|--------|-------|------------|
| `/` | âœ… | âœ… | âœ… | âœ… |
| `/success` | âœ… | âœ… | âœ… | âœ… |
| `/photo/upload` | âœ… | âŒ | âŒ | âŒ |
| `/items` | âŒ | âœ… | âœ… | âœ… |
| `/items/[id]` | âŒ | âœ… | âœ… | âœ… |
| `/items/[id]/review` | âŒ | âœ… | âœ… | âœ… |
| `/admin/users` | âŒ | âŒ | âœ… | âœ… |

## ðŸš€ å¿«é€Ÿå¼€å§‹æ­¥éª¤

### **ç¬¬ä¸€æ¬¡è®¾ç½®**

1. **åˆ›å»ºç¬¬ä¸€ä¸ª Admin**
   ```sql
   -- åœ¨ Supabase SQL Editor ä¸­è¿è¡Œ
   UPDATE auth.users 
   SET app_metadata = jsonb_set(
     COALESCE(app_metadata, '{}'::jsonb), 
     '{role}', 
     '"admin"'
   )
   WHERE email = 'your-email@example.com';
   ```

2. **ç™»å½•æµ‹è¯•**
   - ä½¿ç”¨è®¾ç½®çš„é‚®ç®±å’Œå¯†ç ç™»å½•
   - ç¡®è®¤èƒ½çœ‹åˆ° "Manage Users" å¡ç‰‡

3. **åˆ›å»ºå…¶ä»–ç”¨æˆ·**
   - è®¿é—® `/admin/users` é¡µé¢
   - ä½¿ç”¨ "Add User" åŠŸèƒ½åˆ›å»ºä¸åŒè§’è‰²çš„ç”¨æˆ·

### **æµ‹è¯•ä¸åŒè§’è‰²**

1. **PhotoUser æµ‹è¯•**
   - åˆ›å»º PhotoUser è´¦æˆ·
   - ç™»å½•åŽåº”è¯¥åªèƒ½çœ‹åˆ°ä¸Šä¼ åŠŸèƒ½

2. **Expert æµ‹è¯•**
   - åˆ›å»º Expert è´¦æˆ·
   - ç™»å½•åŽåº”è¯¥èƒ½çœ‹åˆ° Items ç®¡ç†åŠŸèƒ½

3. **Admin æµ‹è¯•**
   - åˆ›å»º Admin è´¦æˆ·
   - ç™»å½•åŽåº”è¯¥èƒ½çœ‹åˆ°ç”¨æˆ·ç®¡ç†åŠŸèƒ½

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨è€ƒè™‘**
   - ä¸è¦åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨é»˜è®¤å¯†ç 
   - å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
   - åŠæ—¶åˆ é™¤ä¸éœ€è¦çš„ç”¨æˆ·

2. **è§’è‰²å˜æ›´**
   - ç”¨æˆ·è§’è‰²å˜æ›´åŽéœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆ
   - å»ºè®®åœ¨è§’è‰²å˜æ›´åŽæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

3. **æƒé™éªŒè¯**
   - æ‰€æœ‰æƒé™æ£€æŸ¥éƒ½åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œ
   - ç¡®ä¿ Supabase RLS ç­–ç•¥æ­£ç¡®é…ç½®

## ðŸ” æ•…éšœæŽ’é™¤

### **å¸¸è§é—®é¢˜**

1. **ç”¨æˆ·æ— æ³•è®¿é—®é¡µé¢**
   - æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦æ­£ç¡®è®¾ç½®
   - ç¡®è®¤ `app_metadata.role` å­—æ®µå­˜åœ¨

2. **è§’è‰²å˜æ›´ä¸ç”Ÿæ•ˆ**
   - ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ cookies

3. **Admin åŠŸèƒ½ä¸å¯è§**
   - ç¡®è®¤ç”¨æˆ·è§’è‰²ä¸º `admin` æˆ– `superadmin`
   - æ£€æŸ¥ Supabase æƒé™è®¾ç½®

### **è°ƒè¯•æ–¹æ³•**

1. **æ£€æŸ¥ç”¨æˆ·è§’è‰²**
   ```javascript
   // åœ¨æµè§ˆå™¨æŽ§åˆ¶å°ä¸­è¿è¡Œ
   const { data: { session } } = await supabase.auth.getSession()
   console.log('User role:', session?.user?.app_metadata?.role)
   ```

2. **æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·**
   ```sql
   SELECT email, app_metadata->>'role' as role, created_at
   FROM auth.users 
   ORDER BY created_at DESC;
   ```


